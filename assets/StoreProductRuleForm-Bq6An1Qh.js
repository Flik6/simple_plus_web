import{aQ as C,d as ce,k as ie,r as o,z as ne,o as n,B as g,w as e,g as a,a as s,h as m,A as pe,c as D,F as E,j as K,f as O,t as L,v as P,i as Q,T as me,D as _e,m as ve,n as fe,_ as ye,E as Ve,H as he,I as ge,L as be,__tla as we}from"./index-IVPz-ih6.js";import{_ as ke,__tla as Ce}from"./Dialog.vue_vue_type_style_index_0_lang-DMbm9tVa.js";import{u as xe,__tla as Se}from"./useMessage-DmGM48R-.js";import{_ as Ne}from"./_plugin-vue_export-helper-BCo6x5W8.js";let H,G,J,W,X,Ue=Promise.all([(()=>{try{return we}catch{}})(),(()=>{try{return Ce}catch{}})(),(()=>{try{return Se}catch{}})()]).then(async()=>{let R,I,M;X=async c=>await C.get({url:"/product/store-product-rule/page",params:c}),R=async(c,F)=>await C.post({url:"/product/store-product-rule/save/"+F,data:c}),J=async c=>await C.delete({url:"/product/store-product-rule/delete?id="+c}),W=async c=>await C.download({url:"/product/store-product-rule/export-excel",params:c}),I={class:"acea-row row-middle",style:{display:"block",width:"100%"}},M={class:"mr5"},H=Ne(ce({__name:"StoreProductRuleForm",emits:["success"],setup(c,{expose:F,emit:Y}){const{t:b}=ie(),x=xe(),w=o(!1),_=o(""),v=o(""),f=o(!1),T=o(""),y=o(!1),B=o(""),t=o({id:0,ruleName:"",ruleValue:[]}),Z=ne({ruleName:[{required:!0,message:"\u89C4\u683C\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],ruleValue:[{required:!0,message:"\u89C4\u683C\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),S=o();F({open:async(r,l)=>{if(f.value=!0,T.value=b("action."+r),B.value=r,ee(),l){y.value=!0;try{t.value=await(async d=>await C.get({url:"/product/store-product-rule/get?id="+d}))(l)}finally{y.value=!1}}}});const $=async()=>{if(S&&await S.value.validate()){y.value=!0;try{const r=t.value;B.value==="create"?(await R(r,0),x.success(b("common.createSuccess"))):(await R(r,r.id),x.success(b("common.updateSuccess"))),f.value=!1,Y("success")}finally{y.value=!1}}},ee=()=>{var r;t.value={id:void 0,ruleName:void 0,ruleValue:void 0},(r=S.value)==null||r.resetFields()},ae=()=>{w.value=!0},le=()=>{if(_.value&&v.value){let l={value:_.value,detail:[v.value]};t.value.ruleValue.push(l);var r={};t.value.ruleValue=t.value.ruleValue.reduce(function(d,i){return!r[i.value]&&(r[i.value]=d.push(i)),d},[]),_.value="",v.value="",w.value=!1}else x.success(b("shop.productRuleAdd"))},ue=()=>{w.value=!1};return(r,l)=>{const d=me,i=_e,k=ve,j=fe,te=ye,re=Ve,V=he,se=ge,de=ke,oe=be;return n(),g(de,{title:s(T),modelValue:s(f),"onUpdate:modelValue":l[4]||(l[4]=u=>P(f)?f.value=u:null),width:"1000px"},{footer:e(()=>[a(V,{onClick:$,type:"primary",disabled:s(y)},{default:e(()=>[m("\u786E \u5B9A")]),_:1},8,["disabled"]),a(V,{onClick:l[3]||(l[3]=u=>f.value=!1)},{default:e(()=>[m("\u53D6 \u6D88")]),_:1})]),default:e(()=>[pe((n(),g(se,{ref_key:"formRef",ref:S,model:s(t),rules:s(Z),"label-width":"92px",inline:!0},{default:e(()=>[a(j,{gutter:20},{default:e(()=>[a(k,{class:"mb15"},{default:e(()=>[a(i,{label:"\u89C4\u683C\u540D\u79F0",prop:"ruleName"},{default:e(()=>[a(d,{modelValue:s(t).ruleName,"onUpdate:modelValue":l[0]||(l[0]=u=>s(t).ruleName=u),placeholder:"\u8BF7\u8F93\u5165\u89C4\u683C\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(n(!0),D(E,null,K(s(t).ruleValue,(u,q)=>(n(),g(j,{gutter:20,key:q},{default:e(()=>[a(i,{label:" "},{default:e(()=>[O("div",I,[O("span",M,L(u.value),1),a(te,{icon:"ep:circle-close",onClick:h=>(p=>{t.value.ruleValue.splice(p,1)})(q)},null,8,["onClick"])]),O("div",null,[(n(!0),D(E,null,K(u.detail,(h,p)=>(n(),g(re,{class:"mb5",style:{margin:"2px 4px 2px 0"},closable:"",name:h,key:p,onClose:N=>((U,A)=>{U.splice(A,1)})(u.detail,p)},{default:e(()=>[m(L(h),1)]),_:2},1032,["name","onClose"]))),128)),a(d,{placeholder:"\u8BF7\u8F93\u5165\u5C5E\u6027\u540D\u79F0",modelValue:u.detail.attrsVal,"onUpdate:modelValue":h=>u.detail.attrsVal=h,style:{width:"170px"}},{append:e(()=>[a(V,{type:"primary",onClick:h=>((p,N)=>{if(p){t.value.ruleValue[N].detail.push(p);var U={};t.value.ruleValue[N].detail=t.value.ruleValue[N].detail.reduce(function(A,z){return!U[z]&&(U[z]=A.push(z)),A},[])}else x.success(b("shop.productRuleAttrAdd"))})(u.detail.attrsVal,q)},{default:e(()=>[m("\u6DFB\u52A0")]),_:2},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),_:2},1024)]),_:2},1024))),128)),s(w)?(n(),g(j,{key:0,gutter:20},{default:e(()=>[a(k,{span:9,class:"mr15"},{default:e(()=>[a(i,{label:"\u89C4\u683C\uFF1A"},{default:e(()=>[a(d,{placeholder:"\u8BF7\u8F93\u5165\u89C4\u683C",modelValue:s(_),"onUpdate:modelValue":l[1]||(l[1]=u=>P(_)?_.value=u:null)},null,8,["modelValue"])]),_:1})]),_:1}),a(k,{span:9,class:"mr20"},{default:e(()=>[a(i,{label:"\u89C4\u683C\u503C\uFF1A"},{default:e(()=>[a(d,{modelValue:s(v),"onUpdate:modelValue":l[2]||(l[2]=u=>P(v)?v.value=u:null),placeholder:"\u8BF7\u8F93\u5165\u89C4\u683C\u503C"},null,8,["modelValue"])]),_:1})]),_:1}),a(k,{span:2},{default:e(()=>[a(V,{type:"primary",onClick:le},{default:e(()=>[m("\u786E\u5B9A")]),_:1})]),_:1}),a(k,{span:2},{default:e(()=>[a(V,{onClick:ue},{default:e(()=>[m("\u53D6\u6D88")]),_:1})]),_:1})]),_:1})):Q("",!0),s(w)?Q("",!0):(n(),g(V,{key:1,type:"primary",onClick:ae,class:"ml95 mt10"},{default:e(()=>[m("\u6DFB\u52A0\u65B0\u89C4\u683C")]),_:1}))]),_:1},8,["model","rules"])),[[oe,s(y)]])]),_:1},8,["title","modelValue"])}}}),[["__scopeId","data-v-9d33bacd"]]),G=Object.freeze(Object.defineProperty({__proto__:null,default:H},Symbol.toStringTag,{value:"Module"}))});export{H as S,Ue as __tla,G as a,J as d,W as e,X as g};
