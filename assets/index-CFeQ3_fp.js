import{d as D,k as ia,u as ca,r as w,D as _a,e as ua,S as pa,o as s,c as I,g as a,w as t,a as l,U as M,F as B,j as ma,H as i,h as c,G as m,t as da,i as R,X as fa,J as ya,Q as ha,I as ba,_ as wa,L as ga,M as ka,N as va,O as xa,P as ja,__tla as Ca}from"./index-B2l-tRNr.js";import{_ as Na,__tla as Sa}from"./index-DSgEoFrX.js";import{E as Oa,a as Ra,b as Pa,__tla as Ta}from"./el-dropdown-item-Bopu7-72.js";import{_ as Va,__tla as Ua}from"./DictTag.vue_vue_type_script_lang-BrVJZJtF.js";import{_ as Aa,__tla as qa}from"./ContentWrap.vue_vue_type_script_name_ContentWrap_setup_true_lang-CKAf4vXg.js";import{_ as Ja,__tla as La}from"./index-C1Qk2qgN.js";import{a as za,D as E,__tla as Fa}from"./dict-CQ5i8MG8.js";import{c as P,__tla as Ka}from"./permission-QlbiSXvs.js";import{_ as Da,__tla as Ia}from"./JobForm.vue_vue_type_script_setup_true_name_JobForm_lang-DT-GUozX.js";import{_ as Ma,__tla as Ba}from"./JobDetail.vue_vue_type_script_name_InfraJobDetail_setup_true_lang-MywyqY6p.js";import{d as Ea}from"./download--D_IyRio.js";import{b as Ha,e as Qa,d as Ga,f as Wa,r as Xa,__tla as Za}from"./index-DH5wCNyB.js";import{a as d}from"./constants-BjZq39Lm.js";import{u as $a,__tla as Ya}from"./useMessage-CCK8Vpo2.js";import"./color-DXkOL5Tu.js";import{__tla as at}from"./el-card-DXk2QVka.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import{__tla as tt}from"./Dialog.vue_vue_type_style_index_0_lang-DjDfdkfy.js";import{__tla as et}from"./el-descriptions-item-cmQ7RjCx.js";import{__tla as lt}from"./el-timeline-item-BT2KQe1T.js";import{__tla as rt}from"./formatTime-U2F_5HmG.js";let H,ot=Promise.all([(()=>{try{return Ca}catch{}})(),(()=>{try{return Sa}catch{}})(),(()=>{try{return Ta}catch{}})(),(()=>{try{return Ua}catch{}})(),(()=>{try{return qa}catch{}})(),(()=>{try{return La}catch{}})(),(()=>{try{return Fa}catch{}})(),(()=>{try{return Ka}catch{}})(),(()=>{try{return Ia}catch{}})(),(()=>{try{return Ba}catch{}})(),(()=>{try{return Za}catch{}})(),(()=>{try{return Ya}catch{}})(),(()=>{try{return at}catch{}})(),(()=>{try{return tt}catch{}})(),(()=>{try{return et}catch{}})(),(()=>{try{return lt}catch{}})(),(()=>{try{return rt}catch{}})()]).then(async()=>{let T;T=D({name:"InfraJob"}),H=D({...T,setup(nt){const{t:j}=ia(),f=$a(),{push:Q}=ca(),C=w(!0),V=w(0),U=w([]),o=_a({pageNo:1,pageSize:10,name:void 0,status:void 0,handlerName:void 0}),A=w(),N=w(!1),y=async()=>{C.value=!0;try{const r=await Ha(o);U.value=r.list,V.value=r.total}finally{C.value=!1}},k=()=>{o.pageNo=1,y()},G=()=>{A.value.resetFields(),k()},W=async()=>{try{await f.exportConfirm(),N.value=!0;const r=await Qa(o);Ea.excel(r,"\u5B9A\u65F6\u4EFB\u52A1.xls")}catch{}finally{N.value=!1}},q=w(),J=(r,n)=>{q.value.open(r,n)},X=async r=>{try{await f.confirm("\u786E\u8BA4\u8981\u7ACB\u5373\u6267\u884C\u4E00\u6B21"+r.name+"?",j("common.reminder")),await Xa(r.id),f.success("\u6267\u884C\u6210\u529F"),await y()}catch{}},L=w(),Z=r=>{L.value.open(r)},z=r=>{Q(r>0?"/job/job-log?id="+r:"/job/job-log")};return ua(()=>{y()}),(r,n)=>{const S=Ja,F=fa,v=ya,$=ha,Y=ba,g=wa,u=ga,aa=ka,K=Aa,h=va,ta=Va,O=Oa,ea=Ra,la=Pa,ra=xa,oa=Na,b=pa("hasPermi"),na=ja;return s(),I(B,null,[a(S,{title:"\u5B9A\u65F6\u4EFB\u52A1",url:"https://www.yixiang.co/job/"}),a(S,{title:"\u5F02\u6B65\u4EFB\u52A1",url:"https://www.yixiang.co/async-task/"}),a(S,{title:"\u6D88\u606F\u961F\u5217",url:"https://www.yixiang.co/message-queue/"}),a(K,null,{default:t(()=>[a(aa,{class:"-mb-15px",model:l(o),ref_key:"queryFormRef",ref:A,inline:!0,"label-width":"100px"},{default:t(()=>[a(v,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:t(()=>[a(F,{modelValue:l(o).name,"onUpdate:modelValue":n[0]||(n[0]=e=>l(o).name=e),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",clearable:"",onKeyup:M(k,["enter"]),class:"!w-240px"},null,8,["modelValue","onKeyup"])]),_:1}),a(v,{label:"\u4EFB\u52A1\u72B6\u6001",prop:"status"},{default:t(()=>[a(Y,{modelValue:l(o).status,"onUpdate:modelValue":n[1]||(n[1]=e=>l(o).status=e),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u72B6\u6001",clearable:"",class:"!w-240px"},{default:t(()=>[(s(!0),I(B,null,ma(l(za)(l(E).INFRA_JOB_STATUS),e=>(s(),i($,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",prop:"handlerName"},{default:t(()=>[a(F,{modelValue:l(o).handlerName,"onUpdate:modelValue":n[2]||(n[2]=e=>l(o).handlerName=e),placeholder:"\u8BF7\u8F93\u5165\u5904\u7406\u5668\u7684\u540D\u5B57",clearable:"",onKeyup:M(k,["enter"]),class:"!w-240px"},null,8,["modelValue","onKeyup"])]),_:1}),a(v,null,{default:t(()=>[a(u,{onClick:k},{default:t(()=>[a(g,{icon:"ep:search",class:"mr-5px"}),c(" \u641C\u7D22")]),_:1}),a(u,{onClick:G},{default:t(()=>[a(g,{icon:"ep:refresh",class:"mr-5px"}),c(" \u91CD\u7F6E")]),_:1}),m((s(),i(u,{type:"primary",plain:"",onClick:n[3]||(n[3]=e=>J("create"))},{default:t(()=>[a(g,{icon:"ep:plus",class:"mr-5px"}),c(" \u65B0\u589E ")]),_:1})),[[b,["infra:job:create"]]]),m((s(),i(u,{type:"success",plain:"",onClick:W,loading:l(N)},{default:t(()=>[a(g,{icon:"ep:download",class:"mr-5px"}),c(" \u5BFC\u51FA ")]),_:1},8,["loading"])),[[b,["infra:job:export"]]]),m((s(),i(u,{type:"info",plain:"",onClick:z},{default:t(()=>[a(g,{icon:"ep:zoom-in",class:"mr-5px"}),c(" \u6267\u884C\u65E5\u5FD7 ")]),_:1})),[[b,["infra:job:query"]]])]),_:1})]),_:1},8,["model"])]),_:1}),a(K,null,{default:t(()=>[m((s(),i(ra,{data:l(U)},{default:t(()=>[a(h,{label:"\u4EFB\u52A1\u7F16\u53F7",align:"center",prop:"id"}),a(h,{label:"\u4EFB\u52A1\u540D\u79F0",align:"center",prop:"name"}),a(h,{label:"\u4EFB\u52A1\u72B6\u6001",align:"center",prop:"status"},{default:t(e=>[a(ta,{type:l(E).INFRA_JOB_STATUS,value:e.row.status},null,8,["type","value"])]),_:1}),a(h,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",align:"center",prop:"handlerName"}),a(h,{label:"\u5904\u7406\u5668\u7684\u53C2\u6570",align:"center",prop:"handlerParam"}),a(h,{label:"CRON \u8868\u8FBE\u5F0F",align:"center",prop:"cronExpression"}),a(h,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:t(e=>[m((s(),i(u,{type:"primary",link:"",onClick:x=>J("update",e.row.id)},{default:t(()=>[c(" \u4FEE\u6539 ")]),_:2},1032,["onClick"])),[[b,["infra:job:update"]]]),m((s(),i(u,{type:"primary",link:"",onClick:x=>(async _=>{try{const p=_.status===d.STOP?"\u5F00\u542F":"\u5173\u95ED";await f.confirm("\u786E\u8BA4\u8981"+p+'\u5B9A\u65F6\u4EFB\u52A1\u7F16\u53F7\u4E3A"'+_.id+'"\u7684\u6570\u636E\u9879?',j("common.reminder"));const sa=_.status===d.STOP?d.NORMAL:d.STOP;await Ga(_.id,sa),f.success(p+"\u6210\u529F"),await y()}catch{_.status=_.status===d.NORMAL?d.STOP:d.NORMAL}})(e.row)},{default:t(()=>[c(da(e.row.status===l(d).STOP?"\u5F00\u542F":"\u6682\u505C"),1)]),_:2},1032,["onClick"])),[[b,["infra:job:update"]]]),m((s(),i(u,{type:"danger",link:"",onClick:x=>(async _=>{try{await f.delConfirm(),await Wa(_),f.success(j("common.delSuccess")),await y()}catch{}})(e.row.id)},{default:t(()=>[c(" \u5220\u9664 ")]),_:2},1032,["onClick"])),[[b,["infra:job:delete"]]]),m((s(),i(la,{onCommand:x=>((_,p)=>{switch(_){case"handleRun":X(p);break;case"openDetail":Z(p.id);break;case"handleJobLog":z(p==null?void 0:p.id)}})(x,e.row)},{dropdown:t(()=>[a(ea,null,{default:t(()=>[l(P)(["infra:job:trigger"])?(s(),i(O,{key:0,command:"handleRun"},{default:t(()=>[c(" \u6267\u884C\u4E00\u6B21 ")]),_:1})):R("",!0),l(P)(["infra:job:query"])?(s(),i(O,{key:1,command:"openDetail"},{default:t(()=>[c(" \u4EFB\u52A1\u8BE6\u7EC6 ")]),_:1})):R("",!0),l(P)(["infra:job:query"])?(s(),i(O,{key:2,command:"handleJobLog"},{default:t(()=>[c(" \u8C03\u5EA6\u65E5\u5FD7 ")]),_:1})):R("",!0)]),_:1})]),default:t(()=>[a(u,{type:"primary",link:""},{default:t(()=>[a(g,{icon:"ep:d-arrow-right"}),c(" \u66F4\u591A")]),_:1})]),_:2},1032,["onCommand"])),[[b,["infra:job:trigger","infra:job:query"]]])]),_:1})]),_:1},8,["data"])),[[na,l(C)]]),a(oa,{total:l(V),page:l(o).pageNo,"onUpdate:page":n[4]||(n[4]=e=>l(o).pageNo=e),limit:l(o).pageSize,"onUpdate:limit":n[5]||(n[5]=e=>l(o).pageSize=e),onPagination:y},null,8,["total","page","limit"])]),_:1}),a(Da,{ref_key:"formRef",ref:q,onSuccess:y},null,512),a(Ma,{ref_key:"detailRef",ref:L},null,512)],64)}}})});export{ot as __tla,H as default};
